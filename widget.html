<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Widget ESPN</title>
  <style>
    body {
      margin:0;
      background:transparent;
      color:white;
      font-family:Arial, sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .txt {
      font-size:40px;
      font-weight:700;
    }
    img {
      height:60px;
    }
  </style>
</head>
<body>
  <div id="out" class="txt">Loading...</div>

<script>
const qs = new URLSearchParams(location.search);
const slot   = (qs.get('slot') || 'score').toLowerCase();
const gameId = qs.get('gameId');
const out = document.getElementById('out');

async function fetchEspn(gameId){
  const url = `https://site.api.espn.com/apis/site/v2/sports/soccer/summary?event=${gameId}`;
  const r = await fetch(url);
  if(!r.ok) throw new Error("API error");
  const data = await r.json();

  const comp = data.header.competitions[0];
  const home = comp.competitors.find(c=>c.homeAway==="home");
  const away = comp.competitors.find(c=>c.homeAway==="away");

  return {
    homeName: home.team.displayName,
    awayName: away.team.displayName,
    homeLogo: home.team.logo,
    awayLogo: away.team.logo,
    hs: home.score,
    as: away.score
  };
}

async function render(){
  try {
    const g = await fetchEspn(gameId);

    switch(slot){
      case 'homename': out.textContent = g.homeName; break;
      case 'awayname': out.textContent = g.awayName; break;
      case 'homelogo': out.innerHTML = `<img src="${g.homeLogo}">`; break;
      case 'awaylogo': out.innerHTML = `<img src="${g.awayLogo}">`; break;
      case 'score': out.textContent = `${g.hs} - ${g.as}`; break;
      default: out.textContent = 'ERR slot'; break;
    }
  } catch(e){
    out.textContent = "ERR";
    console.error("Widget error:", e);
  }
}

render();
setInterval(render, 20000); // refresh toutes les 20s
</script>
</body>
</html>
