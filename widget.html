<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Widget (ESPN)</title>
  <style>
    html,body{margin:0;background:transparent;color:#fff;font-family:Arial,system-ui}
    .wrap{display:flex;align-items:center;justify-content:center;width:100%;height:100%}
    .txt{font-weight:800;font-size:46px;line-height:1;white-space:nowrap;text-shadow:0 2px 6px rgba(0,0,0,.35)}
    .small{font-size:28px;font-weight:700}
    img{max-height:90%;max-width:100%;object-fit:contain;filter:drop-shadow(0 2px 6px rgba(0,0,0,.35))}
  </style>
</head>
<body>
  <div class="wrap"><div id="out" class="txt">…</div></div>

<script>
const qs    = new URLSearchParams(location.search);
const slot  = (qs.get('slot') || 'score').toLowerCase(); // homeName, homeLogo, awayName, awayLogo, homeScore, awayScore, score, minute, period
const gameId= qs.get('gameId');                          // ex: 746419
const out   = document.getElementById('out');
const prox  = (u)=> u ? `https://images.weserv.nl/?url=${u.replace(/^https?:\/\//,'')}` : '';
function setText(t, small=false){ out.className='txt'+(small?' small':''); out.textContent = t ?? ''; }
function setImg(u){ out.innerHTML = u ? `<img src="${prox(u)}" alt="">` : ''; }

/* ESPN non-officiel (même principe que le site du mec) */
async function fetchEspn(gameId){
  const tries = [
    `https://site.api.espn.com/apis/site/v2/sports/soccer/summary?event=${gameId}`,
    `https://site.api.espn.com/apis/site/v2/sports/soccer/boxscore?event=${gameId}`
  ];
  let data=null;
  for (const url of tries){
    const r = await fetch(url, {cache:'no-store'});
    if (r.ok){ data = await r.json(); break; }
  }
  if (!data) throw new Error('ESPN unreachable');

  // Normalise (selon les pages ESPN, la forme varie)
  const header = data?.header?.competitions?.[0];
  const status = header?.status || data?.boxscore?.status || {};
  const comps  = header?.competitors || [];
  const teams  = comps.length ? comps : (data?.boxscore?.teams || []);

  const home = teams.find(t => (t.homeAway||t.team?.isHome||t.team?.homeAway)==='home') || teams[0] || {};
  const away = teams.find(t => (t.homeAway||t.team?.isHome||t.team?.homeAway)==='away') || teams[1] || {};

  const homeName = home.team?.displayName || home.team?.name || home.shortDisplayName || 'Home';
  const awayName = away.team?.displayName || away.team?.name || away.shortDisplayName || 'Away';
  const homeLogo = (home.team?.logo || home.team?.logos?.[0]?.href || home.logo) || '';
  const awayLogo = (away.team?.logo || away.team?.logos?.[0]?.href || away.logo) || '';
  const hs = Number(home.score ?? home.team?.score ?? 0) || 0;
  const as = Number(away.score ?? away.team?.score ?? 0) || 0;

  const period = status?.type?.shortDetail || status?.period || ''; // ex: 1st Half, 2nd Half, FT
  const clock  = status?.displayClock || '';                        // ex: 45:00

  return { homeName, awayName, homeLogo, awayLogo, hs, as, period, clock };
}

async function render(){
  try{
    if(!gameId) throw new Error('missing gameId');
    const g = await fetchEspn(gameId);

    switch(slot){
      case 'homename':   return setText(g.homeName);
      case 'awayname':   return setText(g.awayName);
      case 'homelogo':   return setImg(g.homeLogo);
      case 'awaylogo':   return setImg(g.awayLogo);
      case 'homescore':  return setText(g.hs);
      case 'awayscore':  return setText(g.as);
      case 'score':      return setText(`${g.hs} - ${g.as}`);
      case 'minute':     return setText(g.clock || '', true);
      case 'period':     return setText(g.period || '', true);
      default:           return setText('??');
    }
  }catch(e){
    console.error(e);
    setText('ERR', true);
  }
}
render();
setInterval(render, 15000); // refresh auto
</script>
</body>
</html>
